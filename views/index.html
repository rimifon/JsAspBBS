<style type="text/css">
.pad{ padding: 2mm 4mm }
.bd .flex .icon{ padding: 2mm 3mm; background-color: var(--bg) }
.bd .flex .box{ border-left: var(--bd) }
.user .ipt{ width: 1in }
.user .auto a{ color: #900; font-weight: bold; text-decoration: underline }
.user .box{ padding: 2mm 4mm }
.bd .box .col{ padding: 2mm 3mm }
.bd .box .odd{ background-color: var(--bg); border-left: var(--bd); border-right:var(--bd) }
.club .tj{ font: 9pt/4mm simsun; min-width: 2cm }
.club .tj b{ color: #900 }
.club .col select{ width: 2cm }
.online .list{ border-top: var(--bd); padding-top: 2mm; flex-wrap: wrap; margin-top: 2mm }
.online .list .li{ width: 4cm }
.user .box:hover .add-forum:after{ content: "新建板块" }
.club .cap:hover a.fr:after, .club .title:hover a.fr:after{ content: "管理" }
</style>
<div class="mt">
	<img src="<%= sys.res %>icon/announce.gif" /> 当前没有公告
</div>
<!-- 用户信息 / 登录 -->
<div class="user bd">
	<div class="cap">-=> <%= me().isLogin ? "会员信息预览" : "快速登录入口" %>　&nbsp; [
		来自：<%= env("REMOTE_ADDR") %>，时间：<%= tojson(sys.sTime.getVarDate()).slice(1, -1) %>，
		系统： <%= (env("HTTP_USER_AGENT").match(/windows|android|macintosh|linux|ios|iphone|ipad/i) || [ "未知系统" ])[0] %>
	]</div>
	<div class="flex main">
		<div class="icon"><img src="<%= sys.res %>icon/userlist2.gif" /></div>
		<div class="auto box"><% if(!me().isLogin) { %>
			用户名：<input class="ipt" name="user" placeholder="用户账号" /> &nbsp;
			密 &nbsp;码：<input class="ipt" name="pass" type="password" placeholder="登录密码" /> &nbsp;
			登录到：<select name="redir"><option value=".">论坛首页</option></select> &nbsp;
			<input type="button" value=" 登  录 " /> &nbsp;
			<a href="?r=register">注册新用户</a><% } else { if(me().roleid > 6) { %>
			<a href="?r=admin/forum/0" class="fr add-forum"></a><% } %>
			昵称：<%= me().nick %>，发帖量：<%= me().fatie %>，积分：<%= me().jifen %>，身份：<%= roles[me().roleid] %>，
			登录时间：<%= tojson(me().lasttime).slice(1, -1) %>，<a href="?r=logout">退出登录</a><% } %>
		</div>
	</div>
</div><% for(var i = 0; i < forums.length; i++) { var x = forums[i]; %>
<!-- 板块最新信息 -->
<div class="club mt bd">
	<div class="cap"><% if(me().roleid > 6) { %>
		<a href="?r=admin/forum/<%= x.pid %>" class="fr"></a><% } %>
		<img src="<%= sys.res %>cat1.gif" /> <%= x.nick %>
	</div><% for(var c = 0; c < x.list.length; c++) { var r = x.list[c]; %>
	<div class="flex main">
		<div class="icon flex ac"><div><img src="<%= sys.res %>icon/folder.gif" /></div></div>
		<div class="auto flex box">
			<div class="title col" style="flex: 4"><% if(me().roleid > 6) { %>
				<a href="?r=admin/forum/<%= r.forumid %>" class="fr"></a><% } %>
				<a href="?r=forum/<%= r.forumid %>"><%= r.nick %></a>
				<div><img src="<%= sys.res %>icon/forumme.gif" /><%= r.intro %></div>
			</div>
			<div class="col odd flex ac"><div><select>
				<option>版主列表</option><% for(var b = 0; b < r.banzhu.length; b++) { %>
				<option value="<%= r.banzhu[b].userid %>"><%= r.banzhu[b].nick %></option><% } %>
			</select></div></div>
			<div class="col tj">
				<div>今日：<b class="fr"><%= r.topicday %></b></div>
				<div>主题：<span class="fr"><%= r.topicnum %></span></div>
				<div>回复：<span class="fr"><%= r.replynum %></span></div>
			</div>
			<div class="col odd tj auto">
				<div class="ellipsis">主题：<%= r.title ? r.title.link("?r=topic/" + r.topicid) : "-" %></div>
				<div class="ellipsis">最后发表：<%= r.zuozhe || "-" %></div>
				<div class="ellipsis"><%= r.replytime == null ? "暂时没有更新" : tojson(r.replytime).slice(1, -1) %></div>
			</div>
			<div class="col flex ac"><a><img src="<%= sys.res %>icon/fav_add.gif" /></a></div>
		</div>
	</div><% } %>
</div><% } %>
<!-- 论坛在线统计 -->
<div class="online bd mt">
	<div class="cap">-=&gt; 论坛在线统计 （同时在线峰值：<%= site.topOnline %> 人，发生时刻：<%= new Date(site.topOntime).getVarDate() %>）</div>
	<div class="main flex">
		<div class="icon flex ac"><div><img src="<%= sys.res %>icon/online.gif" /></div></div>
		<div class="box auto pad">
			目前总共有 <%= online.length %> 人在线。其中注册用户 <%= users.reg %> 人，访客 <%= users.guest %> 人。 论坛总共被访问 <%= site.uv %> 次，共被点击 <%= site.pv %> 次。<br />
			在线图例：
			<img src="<%= sys.res %>online/7.gif" />论坛坛主
			<img src="<%= sys.res %>online/6.gif" />论坛总版主
			<img src="<%= sys.res %>online/5.gif" />分类区版主
			<img src="<%= sys.res %>online/4.gif" />论坛版主
			<img src="<%= sys.res %>online/3.gif" />论坛副版主
			<img src="<%= sys.res %>online/2.gif" />认证会员
			<img src="<%= sys.res %>online/1.gif" />普通会员
			<img src="<%= sys.res %>online/0.gif" />客人或隐身会员
			<div class="list flex"><% online.forEach(function(x) { %>
				<div class="li" title="<%= onlineInfo(x) %>">
					<img src="<%= sys.res %>online/<%= x.roleid %>.gif" /><%= x.sessId == ss().sessId ? x.nick.fontcolor("blue") : x.nick %>
				</div><% }); %>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
new function() {
	var ipt = document.querySelectorAll(".user input, .user select");
	if(ipt.length < 4) return;
	ipt[0].onkeypress = ipt[1].onkeypress = function(e) {
		if(e.keyCode != 13) return;
		doLogin();
	};
	ipt[3].onclick = doLogin;
	
	function doLogin() {
		if(!ipt[0].value) return alert("请输入用户名"), ipt[0].focus();
		if(!ipt[1].value) return alert("请输入密码"), ipt[1].focus();
		post("?r=api/login", {
			user: ipt[0].value, pass: ipt[1].value
		}, function(res) {
			if(res.err) return alert(res.err);
			alert(res.msg);
			location.assign(ipt[2].value);
		});
	};
}
</script>